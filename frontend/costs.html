<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cost Management</title>
</head>
<body>
    <h1>Cost Management</h1>

    <section>
        <h2>Add New Cost</h2>
        <form action="{{ url_for('add_new_cost') }}" method="post", id="addCostForm">
            <label>Description:</label>
            <input type="text" name="description" required>

            <label>Amount:</label>
            <input type="text" name="amount" step="0.01" required>

            <button type="submit">Add Cost</button>
        </form>
    </section>

    <section>
        <h2>Existing Costs</h2>
        <table>
            <thead>
                <tr>
                  <th>Ind</th>
                    <th>Description</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for cost in costs %}
              <tr>
                <form action="{{ url_for('update_cost', cost_id = cost.id) }}" method="post" class="updateCostForm" data-cost-id="{{ cost.id }}">
                  <td>{{ loop.index }}</td>
                  <td><input type="text" name="description" value="{{ cost.description }}" required></td>
                  <td><input type="text" name="amount" step="0.01" value="{{ cost.amount }}" required></td>
                  <td>
                    <button type="submit">Update</button>
                  </td>
                </form>
                <td>
                <form action="{{ url_for('delete_cost', cost_id=cost.id) }}" method="post" style="display:inline;">
                  <button type="submit">Delete</button>
                </form>
                </td>
              </tr>
              {% endfor %}
              <table>
            <thead>
                <tr>
                  <th>Ind</th>
                    <th>Description</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for cost in costs %}
              <tr>
                  <td>{{ loop.index }}</td>
                  <td>{{ cost.description }}</td>
                  <td>{{ cost.amount }}</td>
              </tr>
              {% endfor %}
            </tbody>
        </table>
    </section>
</body>
<script>
  document.getElementById("addCostForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const formData = new FormData(this);
  const json = Object.fromEntries(formData.entries());

  fetch("{{ url_for('add_new_cost') }}", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(json)
  })
  .then(res => {
    if (res.redirected) {
      window.location.href = res.url;
    }
  });
});

document.querySelectorAll(".updateCostForm").forEach(form => {
    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const costId = this.dataset.costId;  // â† This grabs data-cost-id
      const formData = new FormData(this);
      const jsonData = Object.fromEntries(formData.entries());

      fetch(`/costs/update-cost/${costId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(jsonData)
      })
      .then(() => {
        window.location.href = "/costs";  // Or use url_for if rendering server-side
      });
    });
  });

</script>
</html>
